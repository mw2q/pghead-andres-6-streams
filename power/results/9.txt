BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%grey%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 266293043.957448
 ALGERIA                   |   1997 | 452587498.151482
 ALGERIA                   |   1996 | 454104715.219085
 ALGERIA                   |   1995 | 458757744.673627
 ALGERIA                   |   1994 | 454801266.347156
 ALGERIA                   |   1993 | 454330415.331086
 ALGERIA                   |   1992 | 453098437.000353
 ARGENTINA                 |   1998 | 273980422.493941
 ARGENTINA                 |   1997 |  475716896.35661
 ARGENTINA                 |   1996 | 472720531.424105
 ARGENTINA                 |   1995 | 461514631.187469
 ARGENTINA                 |   1994 |  462738427.50637
 ARGENTINA                 |   1993 | 464734466.072436
 ARGENTINA                 |   1992 | 464343910.366785
 BRAZIL                    |   1998 | 274972642.573569
 BRAZIL                    |   1997 | 467288793.882164
 BRAZIL                    |   1996 |  465942269.71732
 BRAZIL                    |   1995 | 464561940.726539
 BRAZIL                    |   1994 | 462562983.831406
 BRAZIL                    |   1993 | 464747675.083738
 BRAZIL                    |   1992 | 474689452.755707
 CANADA                    |   1998 | 272772807.043233
 CANADA                    |   1997 | 479018689.270428
 CANADA                    |   1996 | 476259911.515241
 CANADA                    |   1995 | 470515185.502387
 CANADA                    |   1994 | 485157177.498146
 CANADA                    |   1993 | 470135643.969187
 CANADA                    |   1992 | 471848809.332673
 CHINA                     |   1998 |  272355432.60508
 CHINA                     |   1997 | 469479966.717922
 CHINA                     |   1996 |  465591858.01054
 CHINA                     |   1995 | 465146230.523664
 CHINA                     |   1994 | 463371028.645735
 CHINA                     |   1993 | 465666524.283315
 CHINA                     |   1992 | 474001231.893696
 EGYPT                     |   1998 |  277206701.36756
 EGYPT                     |   1997 | 464551277.209748
 EGYPT                     |   1996 | 470601540.477185
 EGYPT                     |   1995 | 455441331.473554
 EGYPT                     |   1994 | 456720605.462913
 EGYPT                     |   1993 | 461063673.369731
 EGYPT                     |   1992 | 459757731.318917
 ETHIOPIA                  |   1998 | 270436612.420253
 ETHIOPIA                  |   1997 | 456470240.349578
 ETHIOPIA                  |   1996 |  458412875.63143
 ETHIOPIA                  |   1995 | 460638963.795405
 ETHIOPIA                  |   1994 | 465009750.492823
 ETHIOPIA                  |   1993 | 460718303.405184
 ETHIOPIA                  |   1992 | 463593971.180593
 FRANCE                    |   1998 | 268315593.503839
 FRANCE                    |   1997 | 457369619.727663
 FRANCE                    |   1996 | 461174465.253222
 FRANCE                    |   1995 | 459932019.868496
 FRANCE                    |   1994 | 456231131.926299
 FRANCE                    |   1993 | 449697861.617948
 FRANCE                    |   1992 | 458038704.092516
 GERMANY                   |   1998 | 283415187.958552
 GERMANY                   |   1997 |  481081758.13805
 GERMANY                   |   1996 |  472820404.03554
 GERMANY                   |   1995 | 483495933.122032
 GERMANY                   |   1994 | 482062997.270045
 GERMANY                   |   1993 | 476085850.782354
 GERMANY                   |   1992 | 470217760.771284
 INDIA                     |   1998 | 275054472.992323
 INDIA                     |   1997 |   480983411.6726
 INDIA                     |   1996 | 477443695.246678
 INDIA                     |   1995 |  468585375.61603
 INDIA                     |   1994 | 480909052.557136
 INDIA                     |   1993 | 471060337.167337
 INDIA                     |   1992 | 475474071.921786
 INDONESIA                 |   1998 | 277177682.813826
 INDONESIA                 |   1997 | 462186133.912718
 INDONESIA                 |   1996 | 461906547.066877
 INDONESIA                 |   1995 | 465972760.122743
 INDONESIA                 |   1994 | 466080152.920137
 INDONESIA                 |   1993 | 467498249.832971
 INDONESIA                 |   1992 |  466353738.12416
 IRAN                      |   1998 |  275647717.12043
 IRAN                      |   1997 | 462349251.231808
 IRAN                      |   1996 | 454328334.079631
 IRAN                      |   1995 | 457655674.182787
 IRAN                      |   1994 | 452784226.616342
 IRAN                      |   1993 |  458525120.76888
 IRAN                      |   1992 | 453109438.412454
 IRAQ                      |   1998 | 277919368.985263
 IRAQ                      |   1997 | 467346051.819843
 IRAQ                      |   1996 | 469751931.104443
 IRAQ                      |   1995 | 467319018.995222
 IRAQ                      |   1994 | 476381591.848087
 IRAQ                      |   1993 | 463550772.950322
 IRAQ                      |   1992 | 474457180.204108
 JAPAN                     |   1998 | 270904817.076951
 JAPAN                     |   1997 | 472362354.860075
 JAPAN                     |   1996 | 460682017.437205
 JAPAN                     |   1995 | 465352481.874008
 JAPAN                     |   1994 | 459697346.226921
 JAPAN                     |   1993 | 463487034.899302
 JAPAN                     |   1992 | 465498435.274419
 JORDAN                    |   1998 | 273756694.832954
 JORDAN                    |   1997 | 464704902.758648
 JORDAN                    |   1996 | 467949064.592698
 JORDAN                    |   1995 | 463445865.773872
 JORDAN                    |   1994 | 459184653.621198
 JORDAN                    |   1993 | 460426857.499329
 JORDAN                    |   1992 | 464658077.171617
 KENYA                     |   1998 | 275149521.031152
 KENYA                     |   1997 | 483867120.627302
 KENYA                     |   1996 | 485787660.020852
 KENYA                     |   1995 | 470659424.424191
 KENYA                     |   1994 | 473306284.100756
 KENYA                     |   1993 | 468606196.268912
 KENYA                     |   1992 | 474429628.371436
 MOROCCO                   |   1998 | 278025887.996864
 MOROCCO                   |   1997 | 469664416.501855
 MOROCCO                   |   1996 |  468398802.27428
 MOROCCO                   |   1995 | 470918389.665619
 MOROCCO                   |   1994 | 466386669.346346
 MOROCCO                   |   1993 | 465459961.109408
 MOROCCO                   |   1992 | 473687423.011639
 MOZAMBIQUE                |   1998 | 268879953.229156
 MOZAMBIQUE                |   1997 | 461826686.528089
 MOZAMBIQUE                |   1996 | 462009748.220349
 MOZAMBIQUE                |   1995 | 457817451.880917
 MOZAMBIQUE                |   1994 | 463326714.774405
 MOZAMBIQUE                |   1993 | 467039079.251779
 MOZAMBIQUE                |   1992 | 468019261.908739
 PERU                      |   1998 | 276299589.472952
 PERU                      |   1997 | 462852505.570184
 PERU                      |   1996 | 462598862.928193
 PERU                      |   1995 | 452962590.401722
 PERU                      |   1994 | 458633800.673523
 PERU                      |   1993 | 456295432.496492
 PERU                      |   1992 | 457076259.985954
 ROMANIA                   |   1998 | 274995206.200536
 ROMANIA                   |   1997 | 465192593.685027
 ROMANIA                   |   1996 | 465680275.827426
 ROMANIA                   |   1995 | 467734570.942285
 ROMANIA                   |   1994 |  467808359.05417
 ROMANIA                   |   1993 | 461606635.663732
 ROMANIA                   |   1992 |   467179850.2113
 RUSSIA                    |   1998 |  274523907.80718
 RUSSIA                    |   1997 | 464465003.874772
 RUSSIA                    |   1996 | 474753725.172492
 RUSSIA                    |   1995 | 472337939.053281
 RUSSIA                    |   1994 | 472675296.038718
 RUSSIA                    |   1993 | 465439755.243095
 RUSSIA                    |   1992 | 469796903.842086
 SAUDI ARABIA              |   1998 | 278115650.581079
 SAUDI ARABIA              |   1997 | 469073992.188091
 SAUDI ARABIA              |   1996 |  465041415.75551
 SAUDI ARABIA              |   1995 | 468196658.377702
 SAUDI ARABIA              |   1994 | 468156452.800479
 SAUDI ARABIA              |   1993 | 467063871.153162
 SAUDI ARABIA              |   1992 | 467897711.116763
 UNITED KINGDOM            |   1998 | 272657540.502361
 UNITED KINGDOM            |   1997 | 460306084.623733
 UNITED KINGDOM            |   1996 | 460641383.224572
 UNITED KINGDOM            |   1995 | 459549519.635155
 UNITED KINGDOM            |   1994 | 459023259.655856
 UNITED KINGDOM            |   1993 | 461699762.286657
 UNITED KINGDOM            |   1992 | 455275658.341465
 UNITED STATES             |   1998 | 272896162.862437
 UNITED STATES             |   1997 | 476392783.989642
 UNITED STATES             |   1996 |    471346826.619
 UNITED STATES             |   1995 | 464774458.362112
 UNITED STATES             |   1994 | 470930048.605864
 UNITED STATES             |   1993 | 471699801.392487
 UNITED STATES             |   1992 | 470675328.496981
 VIETNAM                   |   1998 | 269299581.853351
 VIETNAM                   |   1997 | 461765778.842662
 VIETNAM                   |   1996 | 462734912.870224
 VIETNAM                   |   1995 | 459439619.576959
 VIETNAM                   |   1994 | 463538120.381433
 VIETNAM                   |   1993 | 466369669.099727
 VIETNAM                   |   1992 | 461089605.531004
(175 rows)

COMMIT;
COMMIT
